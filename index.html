<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
<title>Star Wars Planets</title>
<style>

    .group {
        fill: none;
        stroke: #000;
        stroke-width: 1px;
    }

</style>
<body>
<div id="planet-info-div"></div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
    var color = function(population, size){
        var value = 0;
        if(population == "Unknown" || size == "Unknown"){
            console.log("Something is unknown");
            value = 0;
        } else {
            value = population / size;
        }
        if(value < 1000){
            return "#200000"
        } else if (value < 10000){
            return "#400000"
        } else if (value < 100000){
            return "600000"
        } else if (value < 1000000){
            return "#800000"
        } else {
            return "#a00000"
        }
    };

    var size = 960;

    var pack = d3.pack()
            .size([size, size])
            .padding(5);

    var svg = d3.select("body").append("svg")
            .attr("width", size)
            .attr("height", size);



    d3.csv("csvPlanets.csv", type, function(error, data) {
        var planets = data.filter(function(d) { return d.distance === 0; }),
                exoplanets = data.filter(function(d) { return d.distance !== 0; });

        var root = d3.hierarchy({children: [{children: planets}].concat(exoplanets)})
                .sum(function(d) { return d.size * d.size; })
                .sort(function(a, b) {
                    return !a.children - !b.children
                            || isNaN(a.data.distance) - isNaN(b.data.distance)
                            || a.data.distance - b.data.distance;
                });

        pack(root);

        svg.selectAll("circle")
                .data(root.descendants().slice(1))
                .enter().append("circle")
                .attr("r", function(d) { return d.r; })
                .attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; })
                .classed("group", function(d) { return d.children; })
                .filter(function(d) { return d.data; })
                .style("fill", function(d) { return color(d.data.population, d.data.size); })
                .append("title")
                .text(function(d) {
                    return d.data.name
                            + "\nplanet diameter: " + d.data.size + " KM"
                            + "\nplanet population: " + d.data.population
                            + "\nplanet orbital period: " + d.data.orbital_period + " days"
                            + "\nplanet rotation period: " + d.data.rotation_period + " hours"
                            + "\nplanet climate: " + d.data.climate
                            + "\nplanet terrain: " + d.data.terrain;
                });
    });

    function type(d) {
        d.size = +d.size;
        d.distance = d.distance ? +d.distance : NaN;
        return d;
    }

</script>
</body>
